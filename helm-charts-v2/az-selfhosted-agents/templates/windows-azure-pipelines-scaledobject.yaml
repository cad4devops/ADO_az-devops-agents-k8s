apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: azure-pipelines-scaledobject
  namespace: {{ .Values.windowsNamespace }}
spec:
  scaleTargetRef:
    name: {{ .Values.windows.deploy.name }} #Target agent deployment name
  minReplicaCount: {{ .Values.autoscaling.minReplicas }}
  maxReplicaCount: {{ .Values.autoscaling.maxReplicas }} #Maximum number of parallel instances
  triggers:
    - type: azure-pipelines
      metadata:
        poolID: "{{ .Values.poolID.windows }}" #Replace with your agent pool ID
        organizationURLFromEnv: "AZP_URL"
      authenticationRef:
        name: pipeline-trigger-auth
